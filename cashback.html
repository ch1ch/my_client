<!doctype html>
<html lang="cn">
<head>
  <title>河北聚友</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Language" content="zh-CN" />
  <meta id="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport" />
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">

  <meta name="keywords" content="河北聚友"/>
  <meta name="description" content="河北聚友"/>

</head>
<body>
  <div class="loading-box">
    <p class="orderid"></p>
    <p class="status"></p>
  </div> 

  <script src="lib/jquery-1.11.3.min.js"></script>
  <script type="text/javascript">
    // setTimeout(function(){
    //   window.location = 'index.php';
    // }, 2000);

  function getQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
  }

  console.log(getQueryString('id'));
  var orderid='1502606534446';
  var appid='0000001047';
  var url="http://trans.palmf.cn/sdk/v1.0/payOrderResult/"+orderid+'/'+appid;

  $('.orderid').html('订单号：'+orderid);

  $.ajax({
    type: "post",

    data: {},
    dataType: "jsonp",
    url:url,
    crossDomain: true,
     jsonp: "callbackparam",
    jsonpCallback: "Callback",
    beforeSend: function(XMLHttpRequest){

    },
    success: function(data, textStatus){
      console.log(data);
    

    },
    complete: function(XMLHttpRequest, textStatus){
     // console.log(XMLHttpRequest);
     // console.log(textStatus)
    },
    error: function(XMLHttpRequest, textStatus, errorThrown){
      //请求出错处理
      console.log(XMLHttpRequest)
      //console.log(textStatus)
     // console.log(errorThrown)
   }
 });

  var datas={"amount":1,"orderNo":"15026063848255678435","signature":"9a46c55100488d8005c5023962b03ec9","subject":"房卡","openId":"","fee":0,"description":"","body":"购买房卡","paidTime":1502606385000,"errorMsg":"","returnCode":"200","paySt":4,"orderDt":"20170813","appid":"0000001047","extra":"","mchntId":"0000001312","mchntOrderNo":"1502606534446"};

  if (datas.paySt==0) {//0:待支付
    console.log('待支付');
    $('.status').html('订单状态：待支付');
  }else if (datas.paySt==1) {//1:支付中
    $('.status').html('订单状态：支付中');
    console.log('支付中');
  }else if (datas.paySt==2) {//2:支付成功
    $('.status').html('订单状态：支付成功');
    console.log('支付成功');
  }else if (datas.paySt==3) {//3:支付失败
    $('.status').html('订单状态：支付失败');
    console.log('支付失败');
  }else if (datas.paySt==4) {//4：已关闭
    $('.status').html('订单状态：已关闭');
    console.log('已关闭');
  };
  $.ajax({
    type: "post",
    method: "POST",
    data: {orderid:orderid,status:datas.paySt},
    dataType: "json",
    url: "http://localhost:3000/api/cashstatus.api",
    beforeSend: function(XMLHttpRequest){

    },
    success: function(data, textStatus){
      console.log(data);
    },
    complete: function(XMLHttpRequest, textStatus){
      console.log(XMLHttpRequest);
    },
    error: function(err){
      console.log(err);
      //请求出错处理
    }   
  });    
 




    
  </script>
</body>
</html>